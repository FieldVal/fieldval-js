var logger;"function"==typeof require&&(logger=require("tracer").console()),Validator=function(r){var e=this;e.validating=r,e.missing_keys={},e.missing_count=0,e.invalid_keys={},e.invalid_count=0,e.unrecognized_keys={},e.unrecognized_count=0,e.recognized_keys={},e.errors=[]},Validator.REQUIRED_ERROR="required",Validator.NOT_REQUIRED_BUT_MISSING="notrequired",Validator.ONE_OR_MORE_ERRORS=0,Validator.FIELD_MISSING=1,Validator.INCORRECT_FIELD_TYPE=2,Validator.FIELD_UNRECOGNIZED=3,Validator.MULTIPLE_ERRORS=4,Validator.get_value_and_type=function(r,e){if("integer"==e){var o=parseInt(r);isNaN(o)||(""+o).length!=(""+r).length||(r=o,e=o,e="number")}else if("float"==e){var o=parseFloat(r);isNaN(o)||(r=o,e="number")}var i=typeof r;return"object"==i&&"[object Array]"===Object.prototype.toString.call(r)&&(i="array"),{type:i,desired_type:e,value:r}},Validator.use_operators=function(r,e,o,i){for(var t=!1,n=!1,a=function(e){var s;if("object"==typeof e){if("[object Array]"===Object.prototype.toString.call(e)){for(var l=0;l<e.length&&(a(e[l]),!n);l++);return}if(0==e.length)return;flags=e,s=flags.operator,null!=flags&&flags.stop_if_error&&(stop_if_error=!0)}else s=e,stop_if_error=!0;var u=s(r,function(e){r=e});null!=u&&(o&&(u===Validator.REQUIRED_ERROR?i?o.missing(i):o.error({error_message:"Field missing.",error:Validator.FIELD_MISSING}):u===Validator.NOT_REQUIRED_BUT_MISSING||(i?o.invalid(i,u):o.error(u))),t=!0,stop_if_error&&(n=!0))},s=0;s<e.length;s++){var l=e[s];if(a(l),n)break}return t?void 0:r},Validator.required=function(r,e){var o=function(e){return null==e?r||void 0===r?Validator.REQUIRED_ERROR:Validator.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==e?(e.operator=o,e):o},Validator.type=function(r,e,o){"object"==typeof e&&(o=e,e="undefined"!=typeof o.required?o.required:!0);var i=function(o,i){var t=Validator.required(e)(o);if(t)return t;var n=Validator.get_value_and_type(o,r),a=n.desired_type,s=n.type,o=n.value;return s!==a?{error_message:"Incorrect field type. Expected "+a+".",error:Validator.INCORRECT_FIELD_TYPE,expected:a,received:s}:void(i&&i(o))};return void 0!==o?(o.operator=i,o):i},Validator.prototype={"default":function(r){var e=this;return{get:function(){var o=e.get.apply(e,arguments);return"undefined"!=typeof o?o:r}}},get:function(r){var e=this,o=e.validating[r];if(e.recognized_keys[r]=!0,arguments.length>1){var i=Array.prototype.slice.call(arguments,1);o=Validator.use_operators(o,i,e,r)}return o},error:function(r){var e=this;return e.errors.push(r),e},invalid:function(r,e){var o=this,i=o.invalid_keys[r];return null!=i?null!=i.errors?i.errors.push(e):o.invalid_keys[r]={error:Validator.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[i,e]}:(o.invalid_keys[r]=e,o.invalid_count++),o},missing:function(r){var e=this;return e.missing_keys[r]={error_message:"Field missing.",error:Validator.FIELD_MISSING},e.missing_count++,e},unrecognized:function(r){var e=this;return e.unrecognized_keys[r]={error_message:"Unrecognized field.",error:Validator.FIELD_UNRECOGNIZED},e.unrecognized_count++,e},recognized:function(r){var e=this;return e.recognized_keys[r]=!0,e},get_unrecognized:function(){var r=this,e=[];for(var o in r.validating)1!=r.recognized_keys[o]&&e.push(o);return e},end:function(){var r=this,e={},o=!1,i=r.get_unrecognized();for(var t in i)r.unrecognized(i[t]);if(0!==r.missing_count&&(e.missing=r.missing_keys,o=!0),0!==r.invalid_count&&(e.invalid=r.invalid_keys,o=!0),0!==r.unrecognized_count&&(e.unrecognized=r.unrecognized_keys,o=!0),o){if(e.error_message="One or more errors.",e.error=Validator.ONE_OR_MORE_ERRORS,0===r.errors.length)return e;r.errors.push(e)}return 0!==r.errors.length?1===r.errors.length?r.errors[0]:{error:Validator.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:r.errors}:null}},Validator.Error=function(r,e,o){if("object"==typeof r&&"[object Array]"===Object.prototype.toString.call(r)){var i=r;r=i[0],e=i[1],o=i[2]}var t={error:r};return null!=e&&(t.error_message=e),null!=o&&(t.data=o),t},"undefined"!=typeof module&&(module.exports=Validator);