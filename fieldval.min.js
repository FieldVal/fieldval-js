var FieldVal=function(){"use strict";function r(e,n){var t=this;if(t.async_waiting=0,t.validating=e,t.missing_keys={},t.invalid_keys={},t.unrecognized_keys={},t.recognized_keys={},t.errors=[],void 0!==n)if(n){var o;if(n.error===r.ONE_OR_MORE_ERRORS)o=n;else if(n.error===r.MULTIPLE_ERRORS)for(var i=0;i<n.errors.length;i++){var a=n.errors[i];0!==a.error?t.errors.push(a):o=a}else t.errors.push(n);if(o){for(var s in e)e.hasOwnProperty(s)&&(t.recognized_keys[s]=!0);if(o.missing&&(t.missing_keys=o.missing),o.unrecognized){t.unrecognized_keys=o.unrecognized;for(var c in t.unrecognized_keys)t.unrecognized_keys.hasOwnProperty(c)&&delete t.recognized_keys[c]}o.invalid&&(t.invalid_keys=o.invalid)}}else for(var u in e)e.hasOwnProperty(u)&&(t.recognized_keys[u]=!0)}Array.isArray||(Array.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)});var e=function(r){var e;for(e in r)if(r.hasOwnProperty(e))return!1;return!0};r.prototype.dig=function(){var e,n=this,t=arguments[0];e=Array.isArray(t)?t:arguments;for(var o=n.validating,i=n,a=0;a<e.length;a++){var s=e[a];if(o=o[s],void 0===o)return void 0;if(i){var c;c=i instanceof r?i.invalid_keys:i.invalid,c&&(i=c[s])}}return new r(o,i)},r.prototype.invalid=function(){var e,n,t=this,o=arguments[arguments.length-1];if(2===arguments.length){var i=arguments[0];if(!Array.isArray(i))return t.invalid_keys[arguments[0]]=r.add_to_invalid(o,t.invalid_keys[arguments[0]]),t;e=i,n=i.length}else e=arguments,n=arguments.length-1;for(var a=t,s=0;n>s;s++){var c,u=e[s];c=a instanceof r?a.invalid_keys:a.invalid;var _;_=s===n-1?o:c[u],_||(_={error:r.ONE_OR_MORE_ERRORS,error_message:r.ONE_OR_MORE_ERRORS_STRING,invalid:{}}),a instanceof r?a.invalid(u,_):c[u]=r.add_to_invalid(_,c[u]),a=_}return t},r.prototype.default_value=function(r){var e=this;return{get:function(){var n=e.get.apply(e,arguments);return void 0!==n?n:r}}},r.prototype.get=function(e){var n,t=this,o=Array.prototype.slice.call(arguments,1),i=!1,a=t.get_async(e,o,function(r){i=!0,n=r});if(a===r.ASYNC)throw new Error(".get used with async checks, use .get_async.");return n},r.prototype.get_async=function(e,n,t){var o=this;if(!Array.isArray(n))throw new Error(".get_async second argument must be an array of checks");var i=o.validating[e];o.recognized_keys[e]=!0;var a=r.use_checks(i,n,{validator:o,field_name:e,emit:function(r){i=r}},function(){void 0!==t&&t(i)});return a===r.ASYNC?r.ASYNC:void 0},r.prototype.error=function(r){var e=this;return e.errors.push(r),e},r.add_to_invalid=function(e,n){if(void 0!==n){if(void 0!==n.errors){for(var t=0;t<n.errors.length;t++){var o=n.errors;void 0!==o.error&&o.error===e.error&&(n.errors[t]=e)}n.errors.push(e)}else n=void 0!==n.error&&n.error===e.error?e:{error:r.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[n,e]};return n}return e},r.prototype.missing=function(e,n){var t=this;return t.missing_keys[e]=r.create_error(r.MISSING_ERROR,n),t},r.prototype.unrecognized=function(e){var n=this;return n.unrecognized_keys[e]={error_message:"Unrecognized field.",error:r.FIELD_UNRECOGNIZED},n},r.prototype.recognized=function(r){var e=this;return e.recognized_keys[r]=!0,e},r.prototype.get_unrecognized=function(){var r,e=this,n=[];for(r in e.validating)e.validating.hasOwnProperty(r)&&e.recognized_keys[r]!==!0&&n.push(r);return n},r.prototype.async_call_ended=function(){var r=this;r.async_waiting--,r.async_waiting<=0&&r.end_callback&&r.end_callback(r.generate_response(),r.recognized_keys)},r.prototype.generate_response=function(){var n,t=this,o={},i=!1,a={};for(n in t.unrecognized_keys)t.unrecognized_keys.hasOwnProperty(n)&&(a[n]=t.unrecognized_keys[n]);var s,c,u=t.get_unrecognized();for(s=0;s<u.length;s++)c=u[s],a[c]||(a[c]={error_message:"Unrecognized field.",error:r.FIELD_UNRECOGNIZED});if(e(t.missing_keys)||(o.missing=t.missing_keys,i=!0),e(t.invalid_keys)||(o.invalid=t.invalid_keys,i=!0),e(a)||(o.unrecognized=a,i=!0),i){if(o.error_message=r.ONE_OR_MORE_ERRORS_STRING,o.error=r.ONE_OR_MORE_ERRORS,0===t.errors.length)return o;t.errors.push(o)}return 0!==t.errors.length?1===t.errors.length?t.errors[0]:{error:r.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:t.errors}:null},r.prototype.end=function(r){var e=this;return r?(e.end_callback=r,void(e.async_waiting<=0&&r(e.generate_response(),e.recognized_keys))):e.generate_response()},r.prototype.end_with_recognized=function(r){var e=this;if(r)e.end(r);else if(e.async_waiting>0)return[e.generate_response(),e.recognized_keys]},r.ASYNC=-1,r.REQUIRED_ERROR=Math.sqrt,r.NOT_REQUIRED_BUT_MISSING=Math.floor,r.ONE_OR_MORE_ERRORS=0,r.ONE_OR_MORE_ERRORS_STRING="One or more errors.",r.FIELD_MISSING=1,r.INCORRECT_FIELD_TYPE=2,r.FIELD_UNRECOGNIZED=3,r.MULTIPLE_ERRORS=4,r.INCORRECT_TYPE_ERROR=function(e,n){return{error_message:"Incorrect field type. Expected "+e+".",error:r.INCORRECT_FIELD_TYPE,expected:e,received:n}},r.MISSING_ERROR=function(){return{error_message:"Field missing.",error:r.FIELD_MISSING}},r.get_value_and_type=function(r,e,n){n||(n={});var t=void 0!==n.parse?n.parse:!1;if("string"!=typeof r||t)if("integer"===e){for(var o=!1,i=0;i<r.length;i++){var a=r[i].charCodeAt(0);if(!(a>=48&&57>=a||45===a)){o=!0;break}}o||(r=parseInt(r),e="number")}else if("float"===e||"number"===e){for(var o=!1,i=0;i<r.length;i++){var a=r[i].charCodeAt(0);if(!(a>=48&&57>=a||46===a||45===a)){o=!0;break}}o||(r=parseFloat(r),e="number")}else"boolean"===e&&("true"===r&&(r=!0),"false"===r&&(r=!1));var s=typeof r;return"object"===s&&Array.isArray(r)&&(s="array"),{type:s,desired_type:e,value:r}},r.use_check=function(e,n,t){var o,i=!0,a={},s=0;if("object"==typeof e){if(Array.isArray(e)){var c=!1,u=e,_=!1,l=function(){if(s++,n.stop||s>u.length)return _=!0,void t();var e=r.use_check(u[s-1],n,function(){l()});e===r.ASYNC&&(c=!0)};return l(),_?c?r.ASYNC:void 0:r.ASYNC}a=e,o=a.check,a&&void 0!==a.stop_on_error&&(i=a.stop_on_error)}else{if("function"!=typeof e)throw new Error("A check can only be provided as a function or as an object with a function as the .check property.");o=e,i=!0}var f=function(e){if(null!==e&&void 0!==e){if(i&&(n.stop=!0),n.had_error=!0,e===r.REQUIRED_ERROR)return void 0!==n.field_name?(n.validator.missing(n.field_name,a),void t()):n.existing_validator?(n.validator.error(r.create_error(r.MISSING_ERROR,a)),void t()):(n.return_missing=!0,void t());e===r.NOT_REQUIRED_BUT_MISSING?t():n.existing_validator?(void 0!==n.field_name?n.validator.invalid(n.field_name,e):n.validator.error(e),t()):(n.validator.error(e),t())}else t()},d=o(n.value,n.emit,function(r){f(r)});return 3===o.length?r.ASYNC:(f(d),null)},r.use_checks=function(e,n,t,o){"function"==typeof t&&(o=t,t=void 0),t||(t={});var i={value:e,field_name:t.field_name,emit:function(r){i.value=r},options:t,stop:!1,return_missing:!1,had_error:!1};t.validator?(i.validator=t.validator,i.existing_validator=!0):i.validator=new r;var a,s=!1,c=function(r){a=r,s=!0,o&&o(r)};i.validator.async_waiting++;var u=r.use_check(n||[],i,function(){return i.had_error?i.options.emit&&i.options.emit(void 0):i.options.emit&&i.options.emit(i.value),i.return_missing?(c(r.REQUIRED_ERROR),void i.validator.async_call_ended()):i.existing_validator?(c(null),void i.validator.async_call_ended()):(c(i.validator.end()),void i.validator.async_call_ended())});return u===r.ASYNC?(o&&(c=o),r.ASYNC):s?a:r.ASYNC},r.required=function(e,n){var t=function(n){return null===n||void 0===n?e||void 0===e?r.REQUIRED_ERROR:r.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==n?(n.check=t,n):t},r.type=function(e,n){var t=n&&void 0!==n.required?n.required:!0,o=function(o,i){var a=r.required(t)(o);if(a)return a;var s=r.get_value_and_type(o,e,n),c=s.desired_type,u=s.type;return o=s.value,u!==c?r.create_error(r.INCORRECT_TYPE_ERROR,n,c,u):void(i&&i(o))};return void 0!==n?(n.check=o,n):o},r.create_error=function(e,n){if(!n)return e.apply(null,Array.prototype.slice.call(arguments,2));if(e===r.MISSING_ERROR){var t=typeof n.missing_error;if("function"===t)return n.missing_error.apply(null,Array.prototype.slice.call(arguments,2));if("object"===t)return n.missing_error;if("string"===t)return{error_message:n.missing_error}}else{var o=typeof n.error;if("function"===o)return n.error.apply(null,Array.prototype.slice.call(arguments,2));if("object"===o)return n.error;if("string"===o)return{error_message:n.error}}return e.apply(null,Array.prototype.slice.call(arguments,2))};var n=function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(r,e){var n;if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),o=t.length>>>0;if(0===o)return-1;var i=+e||0;if(1/0===Math.abs(i)&&(i=0),i>=o)return-1;for(n=Math.max(i>=0?i:o-Math.abs(i),0);o>n;){if(n in t&&t[n]===r)return n;n++}return-1});var e={errors:{too_short:function(r){return{error:100,error_message:"Length is less than "+r}},too_long:function(r){return{error:101,error_message:"Length is greater than "+r}},too_small:function(r){return{error:102,error_message:"Value is less than "+r}},too_large:function(r){return{error:103,error_message:"Value is greater than "+r}},not_in_list:function(){return{error:104,error_message:"Value is not a valid choice"}},cannot_be_empty:function(){return{error:105,error_message:"Value cannot be empty."}},no_prefix:function(r){return{error:106,error_message:"Value does not have prefix: "+r}},invalid_email:function(){return{error:107,error_message:"Invalid email address format."}},invalid_url:function(){return{error:108,error_message:"Invalid url format."}},incorrect_length:function(r){return{error:109,error_message:"Length is not equal to "+r}},no_suffix:function(r){return{error:110,error_message:"Value does not have suffix: "+r}},not_equal:function(r){return{error:113,error_message:"Not equal to "+r+"."}},no_valid_option:function(){return{error:115,error_message:"None of the options were valid."}},contains_whitespace:function(){return{error:116,error_message:"Contains whitespace."}},must_start_with_letter:function(){return{error:117,error_message:"Must start with a letter."}},value_in_list:function(){return{error:104,error_message:"Value not allowed"}},should_not_contain:function(r){var e=r.join(",");return{error:105,error_message:"Cannot contain "+e}}},equal_to:function(n,t){var o=function(o){return o!==n?r.create_error(e.errors.not_equal,t,n):void 0};return t?(t.check=o,t):{check:o}},merge_required_and_flags:function(r,e){return"object"==typeof r?e=r:(e||(e={}),e.required=r),e},integer:function(n,t){return r.type("integer",e.merge_required_and_flags(n,t))},number:function(n,t){return r.type("number",e.merge_required_and_flags(n,t))},array:function(n,t){return r.type("array",e.merge_required_and_flags(n,t))},object:function(n,t){return r.type("object",e.merge_required_and_flags(n,t))},"float":function(n,t){return r.type("float",e.merge_required_and_flags(n,t))},"boolean":function(n,t){return r.type("boolean",e.merge_required_and_flags(n,t))},string:function(n,t){t=e.merge_required_and_flags(n,t);var o=function(e,o){var i=r.type("string",t);"object"==typeof i&&(i=i.check);var a=i(e,o);return a?a:(t&&t.trim===!1||(e=e.trim()),0===e.length?n||void 0===n?r.REQUIRED_ERROR:r.NOT_REQUIRED_BUT_MISSING:void 0)};return t?(t.check=o,t):{check:o}},length:function(n,t){var o=function(o){return o.length!==n?r.create_error(e.errors.incorrect_length,t,n):void 0};return t?(t.check=o,t):{check:o}},min_length:function(n,t){var o=function(o){return o.length<n?r.create_error(e.errors.too_short,t,n):void 0};return t?(t.check=o,t):{check:o}},max_length:function(n,t){var o=function(o){return o.length>n?r.create_error(e.errors.too_long,t,n):void 0};return t?(t.check=o,t):{check:o}},no_whitespace:function(n){var t=function(t){return/\s/.test(t)?r.create_error(e.errors.contains_whitespace,n,max_len):void 0};return n?(n.check=t,n):{check:t}},minimum:function(n,t){var o=function(o){return n>o?r.create_error(e.errors.too_small,t,n):void 0};return t?(t.check=o,t):{check:o}},maximum:function(n,t){var o=function(o){return o>n?r.create_error(e.errors.too_large,t,n):void 0};return t?(t.check=o,t):{check:o}},range:function(n,t,o){var i=function(i){return n>i?r.create_error(e.errors.too_small,o,n):i>t?r.create_error(e.errors.too_large,o,t):void 0};return o?(o.check=i,o):{check:i}},does_not_contain:function(n,t){Array.isArray(n)||(n=[n]);var o=function(o){for(var i=0;i<n.length;i++)if(-1!==o.indexOf(n[i]))return r.create_error(e.errors.should_not_contain,t,n)};return t?(t.check=o,t):{check:o}},one_of:function(n,t){var o=[];if(Array.isArray(n))for(var i=0;i<n.length;i++){var a=n[i];o.push("object"==typeof a?a[0]:a)}else for(var s in n)n.hasOwnProperty(s)&&o.push(s);var c=function(n){return-1===o.indexOf(n)?r.create_error(e.errors.not_in_list,t):void 0};return t?(t.check=c,t):{check:c}},not_one_of:function(n,t){var o=[];if("[object Array]"===Object.prototype.toString.call(n))for(var i=0;i<n.length;i++){var a=n[i];o.push("object"==typeof a?a[0]:a)}else for(var s in n)n.hasOwnProperty(s)&&o.push(s);var c=function(n){return-1!==o.indexOf(n)?r.create_error(e.errors.value_in_list,t):void 0};return t?(t.check=c,t):{check:c}},not_empty:function(n,t){var o=function(o){if(n){if(0===o.trim().length)return r.create_error(e.errors.cannot_be_empty,t)}else if(0===o.length)return r.create_error(e.errors.cannot_be_empty,t)};return t?(t.check=o,t):{check:o}},prefix:function(n,t){var o=function(o){return o.length>=n.length?o.substring(0,n.length)!=n?r.create_error(e.errors.no_prefix,t,n):void 0:r.create_error(e.errors.no_prefix,t,n)};return t?(t.check=o,t):{check:o}},start_with_letter:function(n){var t=function(t){if(!(t.length>0))return r.create_error(e.errors.must_start_with_letter,n);var o=t.charCodeAt(0);return o>=65&&90>=o||o>=97&&122>=o?void 0:r.create_error(e.errors.must_start_with_letter,n)};return n?(n.check=t,n):{check:t}},suffix:function(n,t){var o=function(o){return o.length>=n.length?o.substring(o.length-n.length,o.length)!=n?r.create_error(e.errors.no_suffix,t,n):void 0:r.create_error(e.errors.no_suffix,t,n)};return t?(t.check=o,t):{check:o}},each:function(e,n){var t=function(n){var t=new r(null),o=function(o){var i=n[o],a=e(i,o,function(r){n[o]=r});if(a===r.ASYNC)throw new Error(".each used with async checks, use .each_async.");a===r.REQUIRED_ERROR?t.missing(""+o):a&&t.invalid(""+o,a)};if(Array.isArray(n))for(var i=0;i<n.length;i++)o(i);else for(var a in n)n.hasOwnProperty(a)&&o(a);var s=t.end();return s?s:void 0};return n?(n.check=t,n):{check:t}},each_async:function(e,n){var t=function(n,t,o){var i,a=Array.isArray(n);a||(i=Object.keys(n));var s,c,u=new r(null),_=0;a&&(s=_);var l=function(){if(a){if(s++,s>n.length)return void o(u.end());c=n[s-1]}else{if(_++,_>i.length)return void o(u.end());s=i[_-1],c=n[s]}r.use_checks(c,[function(r,n,t){e(r,s,n,t)}],{field_name:a?""+(s-1):s,validator:u,emit:function(r){a?n[s-1]=r:n[s]=r}},function(){l()})};l()};return n?(n.check=t,n):{check:t}},multiple:function(n,t){n=n||[],0===n.length&&console.error("BasicVal.multiple called without possibles.");var o=function(o,i){for(var a=0;a<n.length;a++){var s,c=n[a],u=r.use_checks(o,c,null,null,function(r){s=r});if(u===r.ASYNC)throw new Error(".multiple used with async checks, use .multiple_async.");if(!u)return void 0!==s&&i(s),null}return r.create_error(e.errors.no_valid_option,t)};return t?(t.check=o,t):{check:o}},multiple_async:function(n,t){if(n=n||[],0===n.length)return void console.error("BasicVal.multiple_async called without possibles.");var o,i=function(i,a,s){var c,u=function(r){c=r},_=0,l=function(){if(_++,_>n.length)return void s(r.create_error(e.errors.no_valid_option,t));var o=n[_-1];r.use_checks(i,o,{field_name:null,validator:null,emit:u},function(r){r?l():s(void 0)})};return l(),o};return t?(t.check=i,t):{check:i}},email:function(n){var t=function(t){var o=e.email_regex;return o.test(t)?void 0:r.create_error(e.errors.invalid_email,n)};return n?(n.check=t,n):{check:t}},url:function(n){var t=function(t){var o=e.url_regex;return o.test(t)?void 0:r.create_error(e.errors.invalid_url,n)};return n?(n.check=t,n):{check:t}}};return e.email_regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e.url_regex=/^(https?):\/\/(((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))|((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])))(:[1-9][0-9]+)?(\/)?([\/?].+)?$/,e}.call();return r.BasicVal=n,r}.call();"undefined"!=typeof module&&(module.exports=FieldVal);