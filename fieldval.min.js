var logger;"function"==typeof require&&(logger=require("tracer").console()),FieldVal=function(e){var r=this;r.validating=e,r.missing_keys={},r.missing_count=0,r.invalid_keys={},r.invalid_count=0,r.unrecognized_keys={},r.unrecognized_count=0,r.recognized_keys={},r.errors=[]},FieldVal.INCORRECT_TYPE_ERROR=function(e,r){return{error_message:"Incorrect field type. Expected "+e+".",error:FieldVal.INCORRECT_FIELD_TYPE,expected:e,received:r}},FieldVal.REQUIRED_ERROR="required",FieldVal.NOT_REQUIRED_BUT_MISSING="notrequired",FieldVal.ONE_OR_MORE_ERRORS=0,FieldVal.FIELD_MISSING=1,FieldVal.INCORRECT_FIELD_TYPE=2,FieldVal.FIELD_UNRECOGNIZED=3,FieldVal.MULTIPLE_ERRORS=4,FieldVal.get_value_and_type=function(e,r,i){i||(i={});var n="undefined"!=typeof i.parse?i.parse:!1;if("string"!=typeof e||n)if("integer"==r){var t=parseInt(e);isNaN(t)||(""+t).length!=(""+e).length||(e=t,r=t,r="number")}else if("float"==r){var t=parseFloat(e);isNaN(t)||(e=t,r="number")}var l=typeof e;return"object"==l&&"[object Array]"===Object.prototype.toString.call(e)&&(l="array"),{type:l,desired_type:r,value:e}},FieldVal.use_checks=function(e,r,i,n,t){var l,o=!1,a=!1;i||(l=new FieldVal);for(var u=!1,s=function(r){var t,d;if("object"==typeof r){if("[object Array]"===Object.prototype.toString.call(r)){for(var c=0;c<r.length&&(s(r[c]),!a);c++);return}if(0==r.length)return;flags=r,t=flags.check,null!=flags&&flags.stop_if_error&&(d=!0)}else t=r,d=!0;var _=t(e,function(r){e=r});if(null!=_){if(_===FieldVal.REQUIRED_ERROR)if(n){if(!i)return _;i.missing(n)}else{if(!i)return void(u=!0);i.error({error_message:"Field missing.",error:FieldVal.FIELD_MISSING})}else _===FieldVal.NOT_REQUIRED_BUT_MISSING||(i?n?i.invalid(n,_):i.error(_):l.error(_));o=!0,d&&(a=!0)}},d=0;d<r.length;d++){var c=r[d];if(s(c),u)return FieldVal.REQUIRED_ERROR;if(a)break}return o?t&&t(void 0):t&&t(e),i?void 0:l.end()},FieldVal.required=function(e,r){var i=function(r){return null==r?e||void 0===e?FieldVal.REQUIRED_ERROR:FieldVal.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==r?(r.check=i,r):i},FieldVal.type=function(e,r,i){"object"==typeof r&&(i=r,r="undefined"!=typeof i.required?i.required:!0);var n=function(n,t){var l=FieldVal.required(r)(n);if(l)return l;var o=FieldVal.get_value_and_type(n,e,i),a=o.desired_type,u=o.type,n=o.value;return u!==a?FieldVal.create_error(FieldVal.INCORRECT_TYPE_ERROR,i,a,u):void(t&&t(n))};return void 0!==i?(i.check=n,i):n},FieldVal.prototype.default=function(e){var r=this;return{get:function(){var i=r.get.apply(r,arguments);return"undefined"!=typeof i?i:e}}},FieldVal.prototype.get=function(e){var r=this,i=r.validating[e];if(r.recognized_keys[e]=!0,arguments.length>1){var n=Array.prototype.slice.call(arguments,1);FieldVal.use_checks(i,n,r,e,function(e){i=e})}return i},FieldVal.prototype.error=function(e){var r=this;return r.errors.push(e),r},FieldVal.prototype.invalid=function(e,r){var i=this,n=i.invalid_keys[e];return null!=n?null!=n.errors?n.errors.push(r):i.invalid_keys[e]={error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[n,r]}:(i.invalid_keys[e]=r,i.invalid_count++),i},FieldVal.prototype.missing=function(e){var r=this;return r.missing_keys[e]={error_message:"Field missing.",error:FieldVal.FIELD_MISSING},r.missing_count++,r},FieldVal.prototype.unrecognized=function(e){var r=this;return r.unrecognized_keys[e]={error_message:"Unrecognized field.",error:FieldVal.FIELD_UNRECOGNIZED},r.unrecognized_count++,r},FieldVal.prototype.recognized=function(e){var r=this;return r.recognized_keys[e]=!0,r},FieldVal.prototype.get_unrecognized=function(){var e=this,r=[];for(var i in e.validating)1!=e.recognized_keys[i]&&r.push(i);return r},FieldVal.prototype.end=function(){var e=this,r={},i=!1,n=e.get_unrecognized();for(var t in n)e.unrecognized(n[t]);if(0!==e.missing_count&&(r.missing=e.missing_keys,i=!0),0!==e.invalid_count&&(r.invalid=e.invalid_keys,i=!0),0!==e.unrecognized_count&&(r.unrecognized=e.unrecognized_keys,i=!0),i){if(r.error_message="One or more errors.",r.error=FieldVal.ONE_OR_MORE_ERRORS,0===e.errors.length)return r;e.errors.push(r)}return 0!==e.errors.length?1===e.errors.length?e.errors[0]:{error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:e.errors}:null},FieldVal.create_error=function(e,r){return r?"function"==typeof r.error?r.error.apply(null,Array.prototype.slice.call(arguments,2)):"object"==typeof r.error?r.error:e.apply(null,Array.prototype.slice.call(arguments,2)):e.apply(null,Array.prototype.slice.call(arguments,2))},FieldVal.Error=function(e,r,i){if("object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)){var n=e;e=n[0],r=n[1],i=n[2]}var t={error:e};return null!=r&&(t.error_message=r),null!=i&&(t.data=i),t},"undefined"!=typeof module&&(module.exports=FieldVal);